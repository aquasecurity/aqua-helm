{{- if and (.Values.envoy.enabled) (.Values.gateway.enabled) }}
---
apiVersion: v1
kind: Service
metadata:
  name: {{ .Release.Name }}-gateway-headless-svc
  namespace: {{ .Release.Namespace }}
  labels:
    app: {{ .Release.Name }}-gateway
    chart: "{{ .Chart.Name }}-{{ .Chart.Version | replace "+" "_" }}"
    release: "{{ .Release.Name }}"
    heritage: "{{ .Release.Service }}"
spec:
  clusterIP: None
  type: ClusterIP
  selector:
    app: {{ .Release.Name }}-gateway
  ports:
  {{- range $port := .Values.gateway.service.ports }}
  - name: {{ $port.name }}
    port: {{ $port.port }}
    targetPort: {{ $port.targetPort }}
    {{- if $port.nodePort }}
    nodePort: {{ $port.nodePort }}
    {{- end }}
    {{- if $port.protocol }}
    protocol: {{ $port.protocol }}
    {{- end }}
  {{- end }}

{{- end }}