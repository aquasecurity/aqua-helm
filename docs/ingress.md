# Ingress

This chart provides support for ingress resources. If you have an
ingress controller installed on your cluster, such as [nginx-ingress](https://kubeapps.com/charts/stable/nginx-ingress)
or [traefik](https://kubeapps.com/charts/stable/traefik) you can utilize
the ingress controller to service your Aqua application.

To enable ingress integration, please set `ingress.enabled` to `true`

## Hosts
Most likely you will only want to have one hostname that maps to this
Aqua installation for scripts or end users to interact, then a
separate instance for the AMI's to operate on (see AgentIngress below).
It is however possible to have more than one host.
To facilitate this, the `ingress.hosts` object is an array.

For each item, please indicate a `name`, `tls`, `tlsSecret`, and any
`annotations` that you may want the ingress controller to know about.

Indicating TLS will cause Aqua generate HTTPS urls, and
Aqua will be connected to at port 443. The actual secret that
`tlsSecret` references does not have to be generated by this chart.
However, please note that if TLS is enabled, the ingress record will not
work until this secret exists.

For annotations, please see [this document](https://github.com/kubernetes/ingress-nginx/blob/master/docs/annotations.md).
Not all annotations are supported by all ingress controllers, but this
document does a good job of indicating which annotation is supported by
many popular ingress controllers.


## TLS Secrets
This chart will facilitate the creation of TLS secrets for use with the
ingress controller.

If you are going to use helm to manage the certificates, please copy
these values into the `certificate` and `key` values for a given
`ingress.secrets` entry.

If you are going to manage TLS secrets outside of helm, please
know that you can create a TLS secret by doing the following:

```
kubectl create secret tls aqua-service.tls --key /path/to/key.key --cert /path/to/cert.crt
```

Please see [this example](https://github.com/kubernetes/contrib/tree/master/ingress/controllers/nginx/examples/tls)
for more information.

## Non-public cloud provider deployments (examples)

**Creating an ingress to access the Aqua Server**

Example: IBM Cloud Private includes a bundled ingress controller. A sample ingress yaml file is included in the repo.

```sh
kubectl apply -f ingress-example.yaml
```

**Alternative ingress configuration**

Example: The services charts are set to create `ClusterIP' ingress types. You may tune these as appropriate for your environment.

## Cloud provider ingress documentations

* Google Cloud Platform (GCP) - [Link](https://cloud.google.com/kubernetes-engine/docs/concepts/ingress)
* Amazon Web Services (AWS) - [Link](https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html)
* Microsoft Azure - [Link](https://docs.microsoft.com/en-us/azure/aks/ingress-basic)